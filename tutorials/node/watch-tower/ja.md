---
name: Watch Tower
description: ウォッチタワーの理解と使用
---

## ウォッチタワーはどのように機能するのか？

ライトニングネットワークエコシステムの重要な部分であるウォッチタワーは、ユーザーのライトニングチャネルに追加の保護を提供します。その主な責務は、チャネルの健全性を監視し、一方のチャネル参加者が他方を詐欺しようとした場合に介入することです。

では、ウォッチタワーはどのようにしてチャネルが侵害されたかを判断するのでしょうか？ウォッチタワーは、適切に識別し、侵害に対応するために必要な情報を、チャネルの一方の参加者であるクライアントから受け取ります。この情報には、最新の取引の詳細、現在のチャネルの状態、ペナルティトランザクションを作成するために必要な情報が含まれることが多いです。クライアントは、データをウォッチタワーに送信する前に、プライバシーと秘密を保護するためにそれを暗号化することがあります。これにより、ウォッチタワーはデータを受け取っても、実際に侵害が発生した場合を除き、暗号化されたデータを解読することができません。この暗号化システムにより、クライアントのプライバシーが保護され、ウォッチタワーが許可なくプライベートデータにアクセスすることが防止されます。

## 自分のEye of Satoshiを設定し、貢献を始める方法

Eye of Satoshi ([RUST-TEOS](https://github.com/talaia-labs/rust-teos?ref=blog.summerofbitcoin.org))は、[BOLT 13](https://github.com/sr-gi/bolt13/blob/master/13-watchtowers.md?ref=blog.summerofbitcoin.org)に準拠した非預託型のライトニングウォッチタワーです。主に2つのコンポーネントがあります：

1. teos：CLIとタワーのサーバーサイドのコア機能を含む。このクレートをビルドすると、teosdとteos-cliの二つのバイナリが生成されます。

2. teos-common：サーバーサイドとクライアントサイドの共有機能を含む（クライアントを作成するのに役立ちます）。

タワーを成功裏に実行するには、teosdコマンドでタワーを実行する前にbitcoindが実行されている必要があります。これらのコマンドを実行する前に、bitcoin.confファイルを設定する必要があります。以下はその手順です：

1. ソースからビットコインコアをインストールするか、ダウンロードします。ダウンロード後、bitcoin.confファイルをBitcoinコアのユーザーディレクトリに配置します。ファイルを配置する場所についての詳細は、使用しているオペレーティングシステムによって異なるため、このリンクを確認してください。

2. ファイルを作成する場所を特定したら、以下のオプションを追加します：

'''
#RPC
server=1
rpcuser=<your-user>
rpcpassword=<your-password>

#chain
regtest=1
'''

- server：RPCリクエスト用
- rpcuserとrpcpassword：RPCクライアントがサーバーに認証するため
- regtest：開発を計画している場合には必須ではありませんが、役立ちます。

rpcuserとrpcpasswordは自分で選ぶ必要があります。引用符なしで記述する必要があります。例：

'''
rpcuser=aniketh
rpcpassword=strongpassword
'''

これで、bitcoindを実行するとノードが起動するはずです。

1. タワー部分については、まずソースからteosをインストールする必要があります。このリンクに記載されている指示に従ってください。

2. システムにteosを正常にインストールし、テストを実行した後、最後のステップであるteos.tomlファイルをteosユーザーディレクトリに設定することができます。ファイルは、ホームフォルダーの下の.teosというフォルダーに配置する必要があります（ドットに注意）。たとえば、Linuxの場合は/home/<your-username>/.teosです。場所を見つけたら、teos.tomlファイルを作成し、bitcoindで変更した項目に対応するオプションを設定します。
# Bitcoinのregtestネットワーク設定

以下の設定を行って、Bitcoinのregtestネットワークでのテストを開始しましょう。

```
#bitcoindbtc_network = "regtest"
btc_rpc_user = "<your-user>"
btc_rpc_password = "<your-password>"
```

ユーザー名とパスワードは引用符で囲む必要があります。例えば、以下のように設定します。

```
btc_rpc_user = "aniketh"
btc_rpc_password = "strongpassword"
```

これで、タワーを実行する準備が整いました。regtest上で実行しているため、タワーが最初に接続したときにBitcoinテストネットワークでブロックが採掘されていない可能性があります（もし採掘されていれば、何かが間違っています）。タワーはbitcoindから最新の100ブロックの内部キャッシュを構築するため、最初に実行したときには以下のエラーが発生するかもしれません。

> ERROR [teosd] タワーを開始するのに十分なブロックがありません（必要: 100）。少なくとも100以上のブロックを採掘してください。

regtestを使用しているため、RPCコマンドを発行してブロックを採掘することができます。これにより、mainnetやtestnetなどの他のネットワークで通常見られる10分の中央値時間を待つ必要はありません。ブロックの採掘方法については、bitcoin-cliのヘルプを確認してください。もし何か助けが必要な場合は、この記事を参照してください。

![image](assets/2.webp)

これで、タワーの実行に成功しました。おめでとうございます。🎉